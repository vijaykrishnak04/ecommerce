<%- include ("../partials/adminHeader") %>

<div class="col py-5">
  <div
    class="container mt-5 w-75 border p-5"
    style="background-color: white; border-radius: 40px"
  >
    <form
      action="/admin/postProduct"
      method="post"
      id="form"
      enctype="multipart/form-data"
    >
      <div class="d-flex justify-content-center">
        <h1>Add Product</h1>
      </div>
      <div class="form-outline flex-fill mb-0 mt-4">
        <input
          class="form-control"
          required
          placeholder="Product image"
          id="fileInput"
          type="file"
          name="image"
          id="product_image"
          multiple
        />
        <div id="previews"></div>
      </div>
      <div class="form-outline flex-fill mb-0 mt-4">
        <input
          type="text"
          required
          placeholder="Product name"
          name="product_name"
          id="product_name"
          class="form-control"
        />
      </div>
      <div class="form-outline flex-fill mb-0 mt-4">
        <input
          type="text"
          required
          placeholder="Price"
          name="price"
          id="price"
          class="form-control"
          required
        />
      </div>
      <div class="form-outline flex-fill mb-0 mt-4">
        <input
          type="text"
          required
          placeholder="Description"
          name="description"
          id="description"
          class="form-control"
        />
      </div>
      <div class="form-outline flex-fill mb-0 mt-4">
        <input
          type="text"
          required
          placeholder="Stock"
          name="stock"
          id="stock"
          class="form-control"
        />
      </div>
      <div class="form-outline flex-fill mb-0 mt-4">
        <select
          required
          class="form-select required"
          name="category"
          id="category"
          aria-label="Default select example"
        >
          <option selected value="" disabled="disabled">Category</option>
          <% category.forEach((categories)=> {%>
          <option value="<%=categories._id%>">
            <%=categories.category_name%>
          </option>
          <% }) %>
        </select>
      </div>
      <div class="row p-2 mt-5 mb-2">
        <div class="col-md-12 d-flex justify-content-center">
          <button class="btn btn-success sub-btn btn-lg" type="submit">
            Add Product
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
  crossorigin="anonymous"
></script>

<script>
  const fileInput = document.getElementById("fileInput");
  const previews = document.getElementById("previews");

  fileInput.addEventListener("change", function () {
    previews.innerHTML = "";

    const files = fileInput.files;
    for (let i = 0; i < files.length; i++) {
      const file = files[i];

      const reader = new FileReader();
      reader.addEventListener("load", function () {
        const img = document.createElement("img");
        img.src = reader.result;
        img.style.width = "150px";
        img.style.marginRight = "7.5px";

        previews.appendChild(img);
      });

      reader.readAsDataURL(file);
    }
  });

  const form = document.querySelector('#form');
  const productName = document.querySelector('#product_name');
  const price = document.querySelector('#price');
  const description = document.querySelector('#description');
  const stock = document.querySelector('#stock');
  const category = document.querySelector('#category');

  form.addEventListener('submit', function(event) {
    // Prevent the form from submitting if validation fails
    if (!validateProductName() || !validatePrice() || !validateDescription() || !validateStock() || !validateCategory()) {
      event.preventDefault();
    }
  });

  function validateProductName() {
    if (productName.value.trim() === '') {
      alert('Please enter a product name');
      productName.focus();
      return false;
    }
    return true;
  }

  function validatePrice() {
    const priceRegex = /^\d+(\.\d{1,2})?$/;
    if (!priceRegex.test(price.value)) {
      alert('Please enter a valid price (e.g. 10 or 10.99)');
      price.focus();
      return false;
    }
    return true;
  }

  function validateDescription() {
    if (description.value.trim() === '') {
      alert('Please enter a product description');
      description.focus();
      return false;
    }
    return true;
  }

  function validateStock() {
    const stockRegex = /^[1-9]\d*$/;
    if (!stockRegex.test(stock.value)) {
      alert('Please enter a valid stock quantity (e.g. 10)');
      stock.focus();
      return false;
    }
    return true;
  }

  function validateCategory() {
    if (category.value === '') {
      alert('Please select a product category');
      category.focus();
      return false;
    }
    return true;
  }
</script>

