<%- include ("../partials/adminHeader") %>

<div class="col py-5">
  <div class="container mt-4 w-75 border p-5" style="background-color: white; border-radius: 40px">
    <form action="/admin/postProduct" method="post" id="form" enctype="multipart/form-data">
      <div class="d-flex justify-content-center">
        <h1>Add Product</h1>
      </div>
      <div class="form-outline flex-fill mb-0 mt-4">
        <input class="form-control" required placeholder="Product image" id="fileInput" type="file" name="image" id="product_image" multiple />
        <div id="previews"></div>
      </div>
      <div class="form-outline flex-fill mb-0 mt-4">
        <input type="text" required placeholder="Product name" name="product_name" id="product_name" class="form-control" />
        <small id="productNameError" class="text-danger err"></small>
      </div>
      <div class="form-outline flex-fill mb-0 mt-4">
        <input type="text" required placeholder="Price" name="price" id="price" class="form-control" required />
        <small id="priceError" class="text-danger err"></small>
      </div>
      <div class="form-outline flex-fill mb-1">
        <label class="form-label" for="form3Example1c">Description</label>
        <textarea style="min-height: 10rem;" name="description" id="description" class="form-control"></textarea>
        <small id="descriptionError" class="text-danger err"></small>
      </div>
      <div class="form-outline flex-fill mb-0 mt-4">
        <input type="text" required placeholder="Stock" name="stock" id="stock" class="form-control" />
        <small id="stockError" class="text-danger err"></small>
      </div>
      <div class="form-outline flex-fill mb-0 mt-4">
        <select required class="form-select required" name="category" id="category" aria-label="Default select example">
          <option selected value="" disabled="disabled">Category</option>
          <% category.forEach((categories)=> {%>
          <option value="<%=categories._id%>">
            <%=categories.category_name%>
          </option>
          <% }) %>
        </select>
      </div>
      <div class="row p-2 mt-3 mb-2">
        <div class="col-md-12 d-flex justify-content-center">
          <button id="submit-btn" class="btn btn-success sub-btn btn-lg" type="submit">
            Add Product
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<!--===============================================================================================-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>

<script>
  const fileInput = document.getElementById("fileInput");
  const previews = document.getElementById("previews");
  fileInput.addEventListener("change", function() {
    previews.innerHTML = "";
    const files = fileInput.files;
    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      const reader = new FileReader();
      reader.addEventListener("load", function() {
        const img = document.createElement("img");
        img.src = reader.result;
        img.style.width = "150px";
        img.style.marginRight = "7.5px";
        previews.appendChild(img);
      });
      reader.readAsDataURL(file);
    }
  });


  const form = document.querySelector('#form');
  const productName = document.querySelector('#product_name');
  const price = document.querySelector('#price');
  const description = document.querySelector('#description');
  const stock = document.querySelector('#stock');
  const category = document.querySelector('#category');

  form.addEventListener('submit', (e) => {
    let errors = [];

    if (productName.value.trim() === '') {
      errors.push('Product name is required');
      document.querySelector('#productNameError').textContent = 'Product name is required';
    }

    if (price.value.trim() === '') {
      errors.push('Price is required');
      document.querySelector('#priceError').textContent = 'Price is required';
    } else if (!/^[0-9.]+$/.test(price.value.trim())) {
      errors.push('Price must be a number');
      document.querySelector('#priceError').textContent = 'Price must be a number';
    }

    if (description.value.trim() === '') {
      errors.push('Description is required');
      document.querySelector('#descriptionError').textContent = 'Description is required';
    }

    if (stock.value.trim() === '') {
      errors.push('Stock is required');
      document.querySelector('#stockError').textContent = 'Stock is required';
    } else if (!/^[0-9]+$/.test(stock.value.trim())) {
      errors.push('Stock must be a whole number');
      document.querySelector('#stockError').textContent = 'Stock must be a whole number';
    }

    if (category.value === '') {
      errors.push('Category is required');
    }

    if (errors.length > 0) {
      e.preventDefault();
    }
  });
</script>